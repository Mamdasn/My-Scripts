#!/bin/bash

avg () {
	echo "($@)/$#" | tr " " "+" | bc
}

STATUS="$(cat /sys/class/power_supply/BAT0/status 2> /dev/null)"
AC="$(cat /sys/class/power_supply/AC/online 2> /dev/null)"

CAP0="$(cat /sys/class/power_supply/BAT0/capacity 2> /dev/null)"
CAP1="$(cat /sys/class/power_supply/BAT1/capacity 2> /dev/null)"
CAP=$(avg $CAP0 $CAP1)

Color() {
    [ $1 -lt 10 ] &&  echo "#FF0000" && return
    [ $1 -lt 20 ] &&  echo "#FF4000" && return
    [ $1 -lt 30 ] &&  echo "#FF8000" && return
    [ $1 -lt 40 ] &&  echo "#FFBF00" && return
    [ $1 -lt 50 ] &&  echo "#FFFF00" && return
    [ $1 -lt 60 ] &&  echo "#B0FF00" && return
    [ $1 -lt 70 ] &&  echo "#80FF00" && return
    [ $1 -lt 80 ] &&  echo "#40FF00" && return
    [ $1 -lt 90 ] &&  echo "#20FF00" && return
    [ $1 -le 100 ] && echo "#00FF00" && return
}

Meter () {
    [ $1 -lt 5 ]  &&  echo ‚ñí‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 10 ] &&  echo ‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 15 ] &&  echo ‚ñà‚ñí‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 20 ] &&  echo ‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 25 ] &&  echo ‚ñà‚ñà‚ñí‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 30 ] &&  echo ‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 35 ] &&  echo ‚ñà‚ñà‚ñà‚ñí‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 40 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 45 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñí‚ñë‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 50 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 55 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 60 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë && return
    [ $1 -lt 65 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñë‚ñë‚ñë && return
    [ $1 -lt 70 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë && return
    [ $1 -lt 75 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñë‚ñë && return
    [ $1 -lt 80 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë && return
    [ $1 -lt 85 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñë && return
    [ $1 -lt 90 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë && return
    [ $1 -lt 95 ] &&  echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí && return
    [ $1 -le 100 ] && echo ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà && return
}

Emoji () {
    status=$1
    ac=$2
    cap=$3
    [ $ac -eq 1 ] && [ $status != "Charging" ] && echo "üîå" && return
    case "$status" in
        "Charging")
            echo "‚ö°"
            ;;
        "Full"|"Not charging"|"Discharging")
            [ $cap -ge 50 ] &&
            echo "üîã" ||
            echo "ü™´"
           ;;
        "Unknown")
            echo "‚ö†Ô∏è" ;;
        *)
            echo "‚ùì" ;;
    esac
}

bat_info="$(printf "%3d%s" " $CAP0" "%")"$([ -n "$CAP1" ] && printf "%3d%s" " $CAP1" "%")
printf "%s %s %s\n" $(Emoji "$STATUS" "$AC" "$CAP0") "$bat_info" "$(Meter $CAP)"
echo
Color $CAP0
